<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.CatchJob.dao.EnterpriseDao">
	
	<select id="selectListEnt" resultMap="entMap">
		SELECT  	ent.ENT_IDX, ent.ENT_NM, ent.ENT_INDUTY_NM,up.SALARY, up.NPN_SBSCRBER_CNT, ld.ADDR_BCITY_NM, ld.ADDR_SIGNGU_NM
		FROM 		ENTERPRISE_TB ent
		LEFT JOIN 	UPDATE_ENT_INFO_TB up
		ON 			ent.ENT_IDX = up.ENT_IDX
		LEFT JOIN 	LEGAL_DONG_TB ld 
		ON 			ent.ADDR_BCITY_CD = ld.ADDR_BCITY_CD 
		AND 		ent.ADDR_SIGNGU_CD = ld.ADDR_SIGNGU_CD
		AND 		ld.ADDR_EMD_CD = IF(ent.ADDR_EMD_CD = ld.ADDR_EMD_CD,ent.ADDR_EMD_CD,0 )
		WHERE 		ent.ENT_SBSCRB_ST = 1 AND  ent.ENT_NM LIKE  CONCAT('%',#{keyword},'%')
		ORDER BY 	LENGTH(ent.ENT_NM),ent.ENT_NM
		
	</select>
	
	<select id="selectListEmpCntRank" parameterType="int" resultType="hashMap">
		SELECT 		ent.ENT_IDX, ent.ENT_NM, up.NPN_SBSCRBER_CNT
		FROM 		ENTERPRISE_TB ent
		LEFT JOIN 	UPDATE_ENT_INFO_TB up
		ON 			ent.ENT_IDX = up.ENT_IDX
		WHERE 		ent.ENT_SBSCRB_ST = 1 
		ORDER BY 	up.NPN_SBSCRBER_CNT DESC 
		LIMIT 		5
	</select>

	<resultMap type="enterprise" id="entMap">
		<result property="entIndex" column="ENT_IDX" />
		<result property="entName" column="ENT_NM" />
		<result property="entBizRegNum" column="ENT_BIZR_NO" />
		<result property="industryCode" column="ENT_INDUTY_CD" />
		<result property="industryName" column="ENT_INDUTY_NM" />
		<result property="entStyleType" column="ENT_STLE_TYPE" />
		<result property="entSubscriberFlag" column="ENT_SBSCRB_ST" />
		<result property="entFlag" column="ENT_FL" />
		<result property="entFoundationDate" column="ENT_FOND_YMD" />
		<result property="entRoadAddrName" column="ENT_ROADADDR_NM" />
		<result property="employeeCount" column="ENT_EMPLOYEE_CNT" />
		<result property="entranceCount" column="NPN_NW_SBSCRBER_CNT" />
		<result property="retirementCount" column="NPN_SCBT_CNT" />
		<result property="evaluationAvg" column="EVALUATION_AVG" />
	</resultMap>
</mapper>

